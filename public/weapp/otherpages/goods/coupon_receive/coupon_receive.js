(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/goods/coupon_receive/coupon_receive","components/ns-show-toast/ns-show-toast"],{"17fc":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("4c22"));function i(e){return e&&e.__esModule?e:{default:e}}var u={data:function(){return{title:""}},mixins:[o.default]};t.default=u},"3eae":function(e,t,n){"use strict";var o=n("fc96"),i=n.n(o);i.a},"4d0f":function(e,t,n){"use strict";n.r(t);var o=n("7782"),i=n.n(o);for(var u in o)"default"!==u&&function(e){n.d(t,e,(function(){return o[e]}))}(u);t["default"]=i.a},5472:function(e,t,n){"use strict";(function(e){n("6b76");o(n("66fd"));var t=o(n("9088"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},7782:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=c(n("f505")),u=c(n("4c22"));function c(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=(o={components:{},data:function(){return{info:{},couponTypeId:0,path:"",button:"领取",uid:0,couponBtnSwitch:!1,memberId:0,receivedNum:0}}},r(o,"components",{nsShowToast:i.default}),r(o,"mixins",[u.default]),r(o,"onLoad",(function(t){var n=this;if(t.source_member&&e.setStorageSync("source_member",t.source_member),t.coupon_type_id&&(this.couponTypeId=t.coupon_type_id),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(e){-1!=e.indexOf("coupon_type_id")&&(n.couponTypeId=e.split("-")[1]),-1!=e.indexOf("source_member")&&(n.source_member=e.split("-")[1])}))}})),r(o,"onShow",(function(){this.$langConfig.refresh(),this.getCoupon(),this.receivedNum=0,e.getStorageSync("token")&&(this.getMemberId(),this.getReceivedNum())})),r(o,"onHide",(function(){this.couponBtnSwitch=!1})),r(o,"methods",{getCoupon:function(){var t=this;this.$api.sendRequest({url:"/coupon/api/coupon/typeinfo",data:{coupon_type_id:this.couponTypeId},success:function(n){var o=n.data;o?(t.info=o,t.path=o.qrcode,t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.buttonRefresh()):t.$util.showToast({title:n.message,success:function(){setTimeout((function(){e.navigateBack({delta:1})}),1e3)}})},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},receiveGoodsCoupon:function(t){var n=this;e.getStorageSync("token")?this.isCanReceive&&(this.couponBtnSwitch||(this.couponBtnSwitch=!0,this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:t,get_type:2},success:function(e){e.data;var t=e.message;0==e.code&&(t="领取成功",n.receivedNum+=1,n.buttonRefresh()),n.$util.showToast({title:t}),n.couponBtnSwitch=!1},fail:function(e){n.couponBtnSwitch=!1}}))):this.$refs.login.open("/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId)},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getReceivedNum:function(){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/receivedNum",data:{coupon_type_id:this.couponTypeId},success:function(t){t.code>=0&&(e.receivedNum=t.data,e.buttonRefresh())}})},buttonRefresh:function(){this.button="领取",this.info.count==this.info.lead_count?this.button="来迟了该优惠券已被领取完了":0==this.info.max_fetch||0==this.receivedNum?this.button="领取":this.info.max_fetch>this.receivedNum?this.button="领取":this.button="该优惠券领取已达到上限"}}),r(o,"computed",{isCanReceive:{get:function(){return this.info.count!=this.info.lead_count&&(0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum)}}}),r(o,"onShareAppMessage",(function(e){var t="恭喜您获得一张"+this.info.money+"元的优惠券";1==this.info.range_type?t+=",满".concat(this.info.at_least,"全场可用"):t+=",满".concat(this.info.at_least,"部分商品可用");var n="/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId;return this.memberId&&(n+="&source_member="+this.memberId),{title:t,path:n,success:function(e){},fail:function(e){}}})),o);t.default=s}).call(this,n("543d")["default"])},"7b3d":function(e,t,n){},"8bf6":function(e,t,n){"use strict";var o={loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"cd2f"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"37fd"))},nsShowToast:function(){return Promise.resolve().then(n.bind(null,"f505"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$util.img(e.path)),o=e.$util.timeStampTurnTime(e.info.end_time);e.$mp.data=Object.assign({},{$root:{g0:n,g1:o}})},u=[];n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return o}))},9088:function(e,t,n){"use strict";n.r(t);var o=n("8bf6"),i=n("4d0f");for(var u in i)"default"!==u&&function(e){n.d(t,e,(function(){return i[e]}))}(u);n("3eae");var c,r=n("f0c5"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);t["default"]=s.exports},a46d:function(e,t,n){"use strict";var o,i=function(){var e=this,t=e.$createElement;e._self._c},u=[];n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return o}))},ad6d:function(e,t,n){"use strict";n.r(t);var o=n("17fc"),i=n.n(o);for(var u in o)"default"!==u&&function(e){n.d(t,e,(function(){return o[e]}))}(u);t["default"]=i.a},ced5:function(e,t,n){"use strict";var o=n("7b3d"),i=n.n(o);i.a},f505:function(e,t,n){"use strict";n.r(t);var o=n("a46d"),i=n("ad6d");for(var u in i)"default"!==u&&function(e){n.d(t,e,(function(){return i[e]}))}(u);n("ced5");var c,r=n("f0c5"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"0b2a6f65",null,!1,o["a"],c);t["default"]=s.exports},fc96:function(e,t,n){}},[["5472","common/runtime","common/vendor"]]]);